<?xml version="1.0" encoding="UTF-8"?>
<project name="RbmkSimulator" default="jar" basedir="..">
  <property name="src.dir" value="src"/>
  <property name="lib.dir" value="lib"/>
  <property name="build.dir" value="build"/>
  <property name="classes.dir" value="${build.dir}/classes"/>
  <property name="main.class"  value="com.hartrusion.rbmksim.RbmkSimulator"/>
  <property name="jar.dir" value="${build.dir}/jar"/>
  <property name="jar.name" value="RbmkSimulator.jar"/>

  <target name="init">
    <mkdir dir="${classes.dir}"/>
    <mkdir dir="${jar.dir}"/>
  </target>

  <!-- classpath aus lib/*.jar -->
  <path id="project.classpath">
    <fileset dir="${basedir}/lib" includes="**/*.jar"/>
  </path>

  <!-- Erzeuge eine space-separierte Liste wie "lib/a.jar lib/b.jar" für das Manifest -->
  <path id="lib.path">
    <fileset dir="${basedir}/lib" includes="**/*.jar"/>
  </path>

  <pathconvert property="manifest.classpath" pathsep=" ">
    <path refid="lib.path"/>
    <!-- Mapper sorgt dafür, dass Einträge als "lib/<filename>.jar" erscheinen -->
    <mapper type="glob" from="*" to="lib/*"/>
  </pathconvert>

  <target name="compile" depends="init">
    <echo>Compiling sources from ${src.dir} -> ${classes.dir}</echo>
    <javac srcdir="${src.dir}" destdir="${classes.dir}"
           includeantruntime="false"
           classpathref="project.classpath"
           debug="true" />
  </target>

  <target name="jar" depends="compile">
    <echo>Creating JAR ${jar.dir}/${jar.name} with Main-Class=${main.class}</echo>
    <jar destfile="${jar.dir}/${jar.name}" basedir="${classes.dir}">
      <manifest>
        <attribute name="Main-Class" value="${main.class}"/>
        <!-- Falls keine libs vorhanden sind, ist ${manifest.classpath} leer -->
        <attribute name="Class-Path" value="${manifest.classpath}"/>
      </manifest>
    </jar>
    <echo>JAR created: ${jar.dir}/${jar.name}</echo>
  </target>

  <target name="clean">
    <echo>Cleaning ${build.dir}</echo>
    <delete dir="${build.dir}"/>
  </target>
</project>
